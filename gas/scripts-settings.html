<script>

function saveSettings() {
  google.script.run.withSuccessHandler(function() {  
    $('#frmSaveStatus').text('Settings saved.');
    $('#frmSaveStatus').css( "display", "inline" ).fadeOut( 2000 );
    console.log("Settings saved.")
  }).withFailureHandler(function(error) { 
    console.log(error);
    $('#frmSaveStatus').text('Save failed.');
  }).setUserProps({
       recListPrefix: $('#rttl-prefix').val(),
       destTaskListId: $('#dest-tasklist').val(),
       logVerboseLevel: $('#log-level').val(),
       dateRangeLength: $('#dest-range').val(),
       weekStartsOn: $('#weekStart').val(),
       dateFormat:$('#dateFmt').val(),
       ignoreDeleted:$('#ignoreDeleted').val(),
       slideOverdue:$('#slideOverdue').val()
    });
}

function loadSettings() {
  google.script.run.withSuccessHandler(function(userProps) {
    $('#rttl-prefix').val(userProps.recListPrefix);
    $('#dest-tasklist').val(userProps.destTaskListId);
    $('#log-level').val(userProps.logVerboseLevel);
    $('#dest-range').val(userProps.dateRangeLength);
    $('#weekStart').val(userProps.weekStartsOn);
    $('#dateFmt').val(userProps.dateFormat);
    $('#ignoreDeleted').val(userProps.ignoreDeleted);
    $('#slideOverdue').val(userProps.slideOverdue);
  }).withFailureHandler(function(error){ console.log(error)} )
    .getUserProps();
}


/**
 * Show the returned task lists in the dropdown box.
 * @param {Array.<Object>} taskLists The task lists to show.
 */
  function showTaskLists_Settings(taskLists) {
    var select = $('#dest-tasklist');
    select.empty();
    taskLists.forEach(function(taskList) {
      var option = $('<option>')
          .attr('value', taskList.id)
          .text(taskList.name);
      select.append(option);
    });
    loadSettings();
    loadTaskLists(showRTTLcount);
  }

function showRTTLcount(tl) {
  var prefix = $('#rttl-prefix').val();
  var count = tl.filter(function(i){return 0 == i.name.indexOf(prefix)}).length
  $('#rttl-count').text(count);
}

</script>

