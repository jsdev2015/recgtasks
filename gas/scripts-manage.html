<script>

/**
 * Show the returned task lists in the dropdown box.
 * @param {Array.<Object>} taskLists The task lists to show.
 */
function showTaskLists_Manage(taskLists) {
  var select = $('#tasklist');
  var prefix = $('#rttl-prefix').val();
  select.empty();
  $('#noTaskListsPanel').hide();
  
  taskLists = taskLists.filter(function(i){return i.name.indexOf(prefix) == 0}); //only RTTL lists will be displayed
  
  taskLists.forEach(function(taskList) {
    var option = $('<option>')
      .attr('value', taskList.id)
      .text(taskList.name);
    select.append(option);
  });
  
  if (taskLists.length > 0)
    loadTasks();
  else {
    $('#noTaskListsPanel').show();
    showTasks([]);
  }

}


/**
 * Load the tasks in the currently selected task list.
 */
function loadTasks() {
  $('#tasks').text('Loading...');
  var taskListId = $('#tasklist').val();
  google.script.run.withSuccessHandler(showTasks)
      .getTasks(taskListId);
}

/**
 * Show the returned tasks on the page.
 * @param {Array.<Object>} tasks The tasks to show.
 */
function showTasks(tasks) {
  var list = $('#tasks').empty();
  if (tasks.length > 0) {
    tasks.forEach(function(task) {
      var row = $('<tr>');
      var item = $('<td  class="task">');
      var title = $('<span>').text(task.title);
      item.append(title);
      row.append(item);
      list.append(row);
    });
  } else {
    list.text('No tasks');
  }
}


</script>
